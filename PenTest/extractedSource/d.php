<?php include_once 'config.php' ?>
<?php
if (!isset($_COOKIE["token"]) or !isset($_GET["filepath"]) or !isset($_GET["tmpDir"]))
{
        exit;
}
$sftp_server = "ftp://127.0.0.1/";
$filepath = base64_decode($_GET["filepath"]);
$tmpDir = base64_decode($_GET["tmpDir"]);
$temp_filepath = $tmpDir . basename($filepath);
$curl = CURL_PATH;
$cmd = $curl . " -k  \"" . $sftp_server . $filepath . "\" --user \"" . SFTP_USERNAME . ":" . SFTP_PASSWORD . "\" -o \"" . $temp_filepath .  "\"";
$dump = "";
exec($cmd, $dump);
header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header('Content-Disposition: attachment; filename="'.basename($temp_filepath).'"');
header('Expires: 0');
header('Cache-Control: must-revalidate');
header('Pragma: public');
header('Content-Length: ' . filesize($temp_filepath));
readfile($temp_filepath);
exit;
?>