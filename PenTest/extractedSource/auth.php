<?php
include("custom.php");

function get_row($user, $db)
{
        $ses_sql = mysqli_query($db, "SELECT * FROM users WHERE user='" . $user . "'");
    $row = mysqli_fetch_array($ses_sql,MYSQLI_ASSOC);
    return $row;
}

function authenticate_internal($authType, $user, $password, $db)
{
        if ($authType == "AD")
        {
                $ldap = ldap_connect("ldap.domain.com");
                if ($bind = ldap_bind($ldap, $user, $password)) {
                        $row = get_row($user, $db);
                        setcookie("token", $row['token'], 0, '/');
                header("Location: index.php");
                } else {
                  echo "Wrong username or password.";
                }
        }

        else
        {
                $row = get_row($user, $db);
                setcookie("token", $row['token'], 0, '/');
        header("Location: index.php");
        }
}

function authenticate_external($authType, $user, $password, $db)
{
        $user = addslashes($_POST["user"]);
        $password = addslashes($_POST["password"]);
    $row = get_row($user, $db);
    if($row['password'] == md5($password))
    {
        setcookie("token", $row['token'], 0, '/');
        header("Location: index.php");
    }
    else
    {
        echo "Wrong username or password.";
    }
}
?>