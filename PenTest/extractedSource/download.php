<?php include 'base.php' ?>
<?php
if (!isset($_COOKIE["token"]))
{
        header("Location: login");
}
?>
<?php startblock('style') ?>
<style type="text/css">
        .center {
                margin-left: auto;
                margin-right: auto;
                width: 50%;
                text-align: center;
        }

        input {
                display: block;
                margin: 0 auto;
                color: black;
        }

</style>
<?php endblock() ?>

<?php startblock('content') ?>

<div class="center navbar-default">
        <br>
        <p>
        <?php
        function get_file($hash, $db)
        {
                $ses_sql = mysqli_query($db, "SELECT filepath FROM uploads WHERE hash='" . $hash . "' ORDER BY filepath DESC");
            $row = mysqli_fetch_array($ses_sql,MYSQLI_ASSOC);
            return $row["filepath"];
        }
        if(isset($_POST["submit"])) {
                $filepath = get_file($_POST["hash"], $db);
                $tmpDir = $_POST["tmpDir"];
                if (!$filepath)
                {
                        echo "Hash not found.";
                }
                else
                {
                        header('Location: d?filepath=' . base64_encode($filepath) . "&tmpDir=" . $tmpDir);
                }
        }
        ?>
        </p>
        <form method="post" enctype="multipart/form-data" class="center">
                <h1>Enter hash to download file:</h1>
                <table class="center">
                        <tr>
                                <td>
                                        <input type="text" name="hash" id="hash">
                                        <input type="hidden" name="tmpDir" value="QzpcVGVtcFw=">
                                </td>
                        </tr>
                        <tr>
                                <td>
                                        <br><input type="submit" value="Submit" name="submit">
                                </td>
                        </tr>
                </table>
        </form>
        <br><br>
</div>

<?php endblock() ?>
<?php startblock('script') ?>
<meta http-equiv="PRAGMA" content="NO-CACHE">
<script type="text/javascript" src="/static/js/jquery.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.js"></script>
<script type="text/javascript" src="/static/js/vue.js"></script>
<script type="text/javascript" src="/static/js/vue-carousel-3d.js"></script>
<script type="text/javascript" src="/static/js/jquery_003.js"></script>
<script type="text/javascript" src="/static/js/jquery_002.js"></script>

<script>

        var vm = new Vue({
                el: '#main-slider',
                data: {
                        slides: 7
                },
                mounted: function () {
                        setTimeout(function () {
                                resizeContent();
                        }, 10);
                },
                components: {
                        'carousel-3d': Carousel3d.Carousel3d,
                        'slide': Carousel3d.Slide
                }
        });

        function removeCarousel() {
                if (isMobile()) {
                        $("#main-slider").hide();
                        $(".util-class").attr('class', 'col-xs-6 col-sm-6 col-md-6 col-lg-6 util-class');
                        $(".footer-bs").attr('class', 'col-xs-6 col-sm-6 col-md-6 col-lg-6 footer-bs');
                        $(".mfooter").css("height", "3vh");
                        $('body').css("font-size", "1vh");
                        $(".utilityImg").css("height", "12vh");
                        $(".utilityImg").css("width", "85vw");
                        $(".utility-caption").css("left", "16px");
                        $('.navbar-nav').find("a").css({
                                "font-size": "17px",
                                "padding": "10px 15px"
                        });
                        $("#utilssip").removeClass("utilityImg");
                        $("#utilssip").css({
                                "background-size": "100% 120px",
                                "box-shadow": "-1px 1px 17px #2facfe, -14px 14px 30px #005691",
                                "border": "1px solid black",
                                "height": "12vh",
                                "width": "85vw"
                        });

                }
        }

        function resizeContent() {
                //***** resize utility container *****
                var viewportHeight = $(window).height();
                var viewportWidth = $(window).width();

                var footerHeight = $('#footer_primary').outerHeight();

                if (viewportWidth > 721) {
                        if (viewportHeight < 600) {
                                $('.carousel-3d-slider').height('250px');
                                $('.carousel-3d-slider > .carousel-3d-slide').height('250px');
                                $('.carousel-3d-slider > .carousel-3d-slide').width('370px');
                        } else {
                                $('.carousel-3d-slider > .carousel-3d-slide').height(0.7 * (viewportHeight - 126 -
                                        footerHeight));
                                $('.carousel-3d-slider').height($('.carousel-3d-slider > .carousel-3d-slide').outerHeight());

                                var carouselSlide_width = 1.512931034482759 * $('.carousel-3d-slider > .carousel-3d-slide')
                                        .outerHeight();

                                $('.carousel-3d-slider > .carousel-3d-slide').width(carouselSlide_width);
                                $('.carousel-3d-slider').width(carouselSlide_width);

                                //$('#carouselSection_placeholder').height( $('#carouselSection').outerHeight() );
                                var carouselHeight = $('.carousel-3d-slider').outerHeight();
                        }
                } else {
                        $('.carousel-3d-slider > .carousel-3d-slide').height('245px');
                        $('.carousel-3d-slider > .carousel-3d-slide').width('370px');
                }

                $('#utilityContainer').height(0.7 * (viewportHeight - carouselHeight - footerHeight - 156));
                $('#utilitySection').height($('.utilityClass').height());
        }

        $('.carousel-3d-controls > .prev > span').html('&lt;');
        $('.carousel-3d-controls > .next > span').html('&gt;');

        $(document).ready(function () {
                navbar_init();
                removeCarousel();
                resizeContent();
                navbar_toggle();
        });
</script>
<?php endblock() ?>